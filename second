
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%);
        }

        body.light-mode {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%);
        }

        .bg-animation {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }

        .blob {
            position: absolute;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            filter: blur(80px);
            animation: pulse 4s ease-in-out infinite;
        }

        .blob1 {
            background: rgba(14, 165, 233, 0.3);
            top: -200px;
            left: -200px;
        }

        .blob2 {
            background: rgba(59, 130, 246, 0.3);
            top: 40%;
            right: -200px;
            animation-delay: 1s;
        }

        .blob3 {
            background: rgba(6, 182, 212, 0.3);
            bottom: 0;
            left: 40%;
            animation-delay: 2s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .login-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .login-page.hidden {
            display: none;
        }

        .login-container {
            width: 100%;
            max-width: 500px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light-mode .login-card {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: white;
        }

        body.light-mode .login-header h1 {
            color: #0f172a;
        }

        .login-header p {
            font-size: 1rem;
            color: #bae6fd;
        }

        body.light-mode .login-header p {
            color: #64748b;
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .role-btn {
            padding: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            user-select: none;
        }

        body.light-mode .role-btn {
            background: rgba(0, 0, 0, 0.05);
            color: rgba(0, 0, 0, 0.6);
            border-color: #e2e8f0;
        }

        .role-btn.active {
            background: linear-gradient(to right, #0ea5e9, #2563eb);
            border-color: #0ea5e9;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.4);
        }

        .role-btn:hover:not(.active) {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
            transform: scale(1.02);
        }

        .login-links {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.875rem;
        }

        .login-link {
            color: #7dd3fc;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }

        body.light-mode .login-link {
            color: #0284c7;
        }

        .login-link:hover {
            color: #0ea5e9;
            text-decoration: underline;
        }

        .register-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light-mode .register-section {
            background: rgba(255, 255, 255, 0.8);
        }

        .section-title {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1.5rem;
            color: white;
        }

        body.light-mode .section-title {
            color: #0f172a;
        }

        .back-link {
            text-align: center;
            margin-top: 1rem;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 200;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .modal-overlay.show {
            display: flex;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: white;
        }

        body.light-mode .form-group label {
            color: #0f172a;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem;
            font-size: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        body.light-mode .form-group input,
        body.light-mode .form-group select,
        body.light-mode .form-group textarea {
            background: white;
            color: #0f172a;
            border-color: #e2e8f0;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        body.light-mode .form-group input::placeholder,
        body.light-mode .form-group textarea::placeholder {
            color: rgba(0, 0, 0, 0.4);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0ea5e9;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(to right, #0ea5e9, #2563eb);
            color: white;
        }

        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.4);
        }

        .demo-text {
            margin-top: 1rem;
            text-align: center;
            color: rgba(255,255,255,0.6);
            font-size: 0.875rem;
        }

        body.light-mode .demo-text {
            color: rgba(0,0,0,0.5);
        }

        .dashboard {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light-mode .top-bar {
            background: rgba(255, 255, 255, 0.9);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
        }

        body.light-mode .user-name {
            color: #0f172a;
        }

        .badge {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .badge-admin {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }

        .badge-employee {
            background: rgba(14, 165, 233, 0.2);
            color: #7dd3fc;
        }

        .actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn-icon {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        body.light-mode .btn-icon {
            background: rgba(0, 0, 0, 0.05);
            color: #0f172a;
        }

        .btn-icon:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
        }

        body.light-mode .nav-tab {
            background: rgba(0, 0, 0, 0.05);
            color: rgba(0, 0, 0, 0.5);
        }

        .nav-tab.active {
            background: linear-gradient(to right, #0ea5e9, #2563eb);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(14, 165, 233, 0.4);
        }

        .stat-card.emerald {
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
        }

        .stat-card.violet {
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
        }

        .stat-card.orange {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            color: white;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        body.light-mode .card {
            background: rgba(255, 255, 255, 0.9);
        }

        .card h2 {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: white;
        }

        body.light-mode .card h2 {
            color: #0f172a;
        }

        .asset-item, .request-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #0ea5e9;
            transition: all 0.3s;
        }

        body.light-mode .asset-item,
        body.light-mode .request-item {
            background: rgba(255, 255, 255, 0.6);
        }

        .asset-item:hover,
        .request-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .item-name {
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        body.light-mode .item-name {
            color: #0f172a;
        }

        .status {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 999px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-active, .status-available {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        body.light-mode .status-active,
        body.light-mode .status-available {
            color: #059669;
        }

        .status-maintenance, .status-in-use, .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }

        body.light-mode .status-maintenance,
        body.light-mode .status-in-use,
        body.light-mode .status-pending {
            color: #d97706;
        }

        .status-retired, .status-damaged, .status-lost, .status-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        body.light-mode .status-retired,
        body.light-mode .status-damaged,
        body.light-mode .status-lost,
        body.light-mode .status-rejected {
            color: #dc2626;
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        body.light-mode .status-approved {
            color: #059669;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
        }

        body.light-mode .btn-primary {
            color: #2563eb;
        }

        .btn-success {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        body.light-mode .btn-success {
            color: #059669;
        }

        .btn-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }

        body.light-mode .btn-warning {
            color: #d97706;
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        body.light-mode .btn-danger {
            color: #dc2626;
        }

        .item-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
        }

        body.light-mode .item-details {
            color: rgba(0, 0, 0, 0.7);
        }

        .empty {
            text-align: center;
            padding: 4rem 0;
            color: rgba(255, 255, 255, 0.6);
        }

        body.light-mode .empty {
            color: rgba(0, 0, 0, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light-mode .modal-content {
            background: rgba(255, 255, 255, 0.95);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.75rem;
            color: white;
        }

        body.light-mode .modal-header h2 {
            color: #0f172a;
        }

        .btn-close {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
        }

        body.light-mode .btn-close {
            color: #dc2626;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .profile-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9, #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            margin: 0 auto 1rem;
        }

        @media (max-width: 768px) {
            .role-selector { grid-template-columns: 1fr; }
            .login-card { padding: 2rem; }
            .item-details { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: 1fr; }
            .nav-tabs { overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="blob blob1"></div>
        <div class="blob blob2"></div>
        <div class="blob blob3"></div>
    </div>

    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-container">
            <div class="login-card" id="loginCard">
                <div class="login-header">
                    <h1>üè¢ Asset Manager</h1>
                    <p>Secure Login Portal</p>
                </div>

                <div class="role-selector">
                    <button type="button" class="role-btn active" id="adminRoleBtn">
                        <span>üë®‚Äçüíº</span> <span>Admin</span>
                    </button>
                    <button type="button" class="role-btn" id="employeeRoleBtn">
                        <span>üë§</span> <span>Employee</span>
                    </button>
                </div>

                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUser" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" placeholder="Enter password">
                </div>
                
                <button class="btn" id="loginBtn">Login</button>
                
                <div class="login-links">
                    <a class="login-link" id="registerLink">Create Account</a>
                    <a class="login-link" id="forgotLink">Forgot Password?</a>
                </div>
                
                <p class="demo-text" id="demoText">
                    Demo: admin/admin123 or employee/emp123
                </p>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="modal-overlay" id="registerModal">
        <div class="login-container">
            <div class="register-section">
                <h2 class="section-title">üìù Create Account</h2>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="regUser" placeholder="Choose username">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="regPass" placeholder="Choose password">
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="regName" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="Enter email">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="regPhone" placeholder="Enter phone">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" id="regDept" placeholder="Enter department">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="regRole">
                        <option value="employee">Employee</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button class="btn" id="registerBtn">Register Now</button>
                <div class="back-link">
                    <a class="login-link" id="backFromRegister">‚Üê Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotModal">
        <div class="login-container">
            <div class="register-section">
                <h2 class="section-title">üîë Reset Password</h2>
                
                <div id="otpRequestSection">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="forgotUser" placeholder="Enter your username">
                    </div>
                    <button class="btn" id="sendOtpBtn">Send OTP</button>
                </div>
                
                <div id="otpVerifySection" style="display: none;">
                    <div class="form-group">
                        <label>Enter OTP</label>
                        <input type="text" id="otpInput" placeholder="Enter 6-digit OTP" maxlength="6">
                        <p style="margin-top: 0.5rem; font-size: 0.875rem; color: #10b981;" id="otpSentMsg"></p>
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="forgotNewPass" placeholder="Enter new password">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="forgotConfirmPass" placeholder="Confirm new password">
                    </div>
                    <button class="btn" id="resetPasswordBtn">Reset Password</button>
                    <button class="btn" id="resendOtpBtn" style="margin-top: 0.5rem; background: #64748b;">Resend OTP</button>
                </div>
                
                <div class="back-link">
                    <a class="login-link" id="backFromForgot">‚Üê Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="top-bar">
            <div class="user-info">
                <span class="user-name" id="userName">Welcome</span>
                <span class="badge" id="userBadge">User</span>
            </div>
            <div class="actions">
                <button class="btn-icon" onclick="showProfile()">üë§ Profile</button>
                <button class="btn-icon" onclick="toggleTheme()">üåì Theme</button>
                <button class="btn-icon" onclick="handleLogout()">üö™ Logout</button>
            </div>
        </div>

        <!-- Admin Navigation -->
        <div id="adminNav" style="display: none;">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchDashboard('overview')">üìä Overview</button>
                <button class="nav-tab" onclick="switchDashboard('assets')">üì¶ Assets</button>
                <button class="nav-tab" onclick="switchDashboard('assign')">üîÑ Assign/Return</button>
                <button class="nav-tab" onclick="switchDashboard('requests')">üìã Requests</button>
                <button class="nav-tab" onclick="switchDashboard('reports')">üìà Reports</button>
            </div>
        </div>

        <!-- Employee Navigation -->
        <div id="employeeNav" style="display: none;">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchDashboard('myAssets')">üì¶ My Assets</button>
                <button class="nav-tab" onclick="switchDashboard('newRequest')">‚ûï New Request</button>
                <button class="nav-tab" onclick="switchDashboard('myRequests')">üìã My Requests</button>
            </div>
        </div>

        <!-- Admin Overview Tab -->
        <div id="overviewTab" class="tab-content active">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Total Assets</div>
                    <div class="stat-value" id="totalAssets">0</div>
                </div>
                <div class="stat-card emerald">
                    <div class="stat-label">Available Assets</div>
                    <div class="stat-value" id="availableAssets">0</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-label">In Use</div>
                    <div class="stat-value" id="inUseAssets">0</div>
                </div>
                <div class="stat-card violet">
                    <div class="stat-label">Pending Requests</div>
                    <div class="stat-value" id="pendingRequests">0</div>
                </div>
            </div>

            <div class="card">
                <h2>Recent Activities</h2>
                <div id="recentActivities"></div>
            </div>
        </div>

        <!-- Admin Assets Tab -->
        <div id="assetsTab" class="tab-content">
            <div class="card">
                <h2>Add New Asset</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Asset Name *</label>
                        <input type="text" id="assetName" placeholder="e.g., Dell Laptop">
                    </div>
                    <div class="form-group">
                        <label>Asset ID *</label>
                        <input type="text" id="assetId" placeholder="e.g., LAP001">
                    </div>
                    <div class="form-group">
                        <label>Type *</label>
                        <select id="assetType">
                            <option value="">Select Type</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Desktop">Desktop</option>
                            <option value="Mobile">Mobile</option>
                            <option value="Tablet">Tablet</option>
                            <option value="Monitor">Monitor</option>
                            <option value="Keyboard">Keyboard</option>
                            <option value="Mouse">Mouse</option>
                            <option value="Printer">Printer</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Value (‚Çπ)</label>
                        <input type="number" id="assetValue" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="assetStatus">
                            <option value="Available">Available</option>
                            <option value="In-Use">In-Use</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Damaged">Damaged</option>
                            <option value="Lost">Lost</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="assetLocation" placeholder="e.g., Office Floor 2">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="assetDesc" rows="2" placeholder="Additional details"></textarea>
                </div>
                <button class="btn" onclick="saveAsset()">Add Asset</button>
            </div>

            <div class="card">
                <h2>All Assets</h2>
                <div class="form-group">
                    <input type="text" id="searchAssets" placeholder="Search assets..." oninput="loadAssets()">
                </div>
                <div id="assetsList"></div>
            </div>
        </div>

        <!-- Admin Assign/Return Tab -->
        <div id="assignTab" class="tab-content">
            <div class="card">
                <h2>Assign Asset to Employee</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Select Asset *</label>
                        <select id="assignAssetId">
                            <option value="">Select Asset</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Select Employee *</label>
                        <select id="assignEmployeeId">
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Assignment Date</label>
                    <input type="date" id="assignDate">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="assignNotes" rows="2" placeholder="Any special instructions"></textarea>
                </div>
                <button class="btn" onclick="assignAsset()">Assign Asset</button>
            </div>

            <div class="card">
                <h2>Return Asset</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Select Assignment *</label>
                        <select id="returnAssignmentId">
                            <option value="">Select Assignment</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condition *</label>
                        <select id="returnCondition">
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                            <option value="Damaged">Damaged</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Return Notes</label>
                    <textarea id="returnNotes" rows="2" placeholder="Condition details"></textarea>
                </div>
                <button class="btn" onclick="returnAsset()">Return Asset</button>
            </div>

            <div class="card">
                <h2>Current Assignments</h2>
                <div id="assignmentsList"></div>
            </div>
        </div>

        <!-- Admin Requests Tab -->
        <div id="requestsTab" class="tab-content">
            <div class="card">
                <h2>Pending Requests</h2>
                <div id="pendingRequestsList"></div>
            </div>

            <div class="card">
                <h2>All Requests History</h2>
                <div id="allRequestsList"></div>
            </div>
        </div>

        <!-- Admin Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <div class="card">
                <h2>Asset Allocation Report</h2>
                <div id="allocationReport"></div>
            </div>

            <div class="card">
                <h2>Asset History Log</h2>
                <div class="form-group">
                    <select id="historyAssetSelect" onchange="loadAssetHistory()">
                        <option value="">Select Asset</option>
                    </select>
                </div>
                <div id="assetHistoryLog"></div>
            </div>
        </div>

        <!-- Employee My Assets Tab -->
        <div id="myAssetsTab" class="tab-content active">
            <div class="card">
                <h2>My Current Assets</h2>
                <div id="employeeAssetsList"></div>
            </div>
        </div>

        <!-- Employee New Request Tab -->
        <div id="newRequestTab" class="tab-content">
            <div class="card">
                <h2>Request New Asset</h2>
                <div class="form-group">
                    <label>Asset Type *</label>
                    <select id="requestAssetType">
                        <option value="">Select Type</option>
                        <option value="Laptop">Laptop</option>
                        <option value="Desktop">Desktop</option>
                        <option value="Mobile">Mobile</option>
                        <option value="Tablet">Tablet</option>
                        <option value="Monitor">Monitor</option>
                        <option value="Keyboard">Keyboard</option>
                        <option value="Mouse">Mouse</option>
                        <option value="Printer">Printer</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reason for Request *</label>
                    <textarea id="requestReason" rows="3" placeholder="Please explain why you need this asset"></textarea>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="requestPriority">
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>
                <button class="btn" onclick="submitRequest()">Submit Request</button>
            </div>

            <div class="card">
                <h2>Request Asset Return</h2>
                <div class="form-group">
                    <label>Select Asset *</label>
                    <select id="returnRequestAsset">
                        <option value="">Select Asset</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reason for Return</label>
                    <textarea id="returnRequestReason" rows="2" placeholder="Optional"></textarea>
                </div>
                <div class="form-group">
                    <label>Report any damage?</label>
                    <select id="returnDamageReport">
                        <option value="No">No - Asset is in good condition</option>
                        <option value="Minor">Minor damage</option>
                        <option value="Major">Major damage</option>
                    </select>
                </div>
                <div class="form-group" id="damageDetailsGroup" style="display: none;">
                    <label>Damage Details</label>
                    <textarea id="damageDetails" rows="2" placeholder="Describe the damage"></textarea>
                </div>
                <button class="btn" onclick="submitReturnRequest()">Submit Return Request</button>
            </div>
        </div>

        <!-- Employee My Requests Tab -->
        <div id="myRequestsTab" class="tab-content">
            <div class="card">
                <h2>My Request History</h2>
                <div id="employeeRequestsList"></div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ My Profile</h2>
                <button class="btn-close" onclick="closeProfile()">Close</button>
            </div>
            <div class="profile-photo" id="profilePhoto">üë§</div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="profileName">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="profileEmail">
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="profilePhone">
            </div>
            <div class="form-group">
                <label>Department</label>
                <input type="text" id="profileDept">
            </div>
            <div class="form-group">
                <label>Role</label>
                <input type="text" id="profileRole" disabled>
            </div>
            <button class="btn" onclick="updateProfile()">Update Profile</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let assets = [];
        let users = [];
        let assignments = [];
        let requests = [];
        let selectedRole = 'admin';
        let generatedOTP = null;
        let otpUsername = null;

        // Initialize
        function init() {
            const savedUsers = localStorage.getItem('users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            } else {
                users = [
                    {id: 1, username: 'admin', password: 'admin123', name: 'Admin User', role: 'admin', email: 'admin@company.com', phone: '1234567890', dept: 'IT'},
                    {id: 2, username: 'employee', password: 'emp123', name: 'Employee User', role: 'employee', email: 'emp@company.com', phone: '0987654321', dept: 'Sales'}
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }

            const savedAssets = localStorage.getItem('assets');
            if (savedAssets) assets = JSON.parse(savedAssets);

            const savedAssignments = localStorage.getItem('assignments');
            if (savedAssignments) assignments = JSON.parse(savedAssignments);

            const savedRequests = localStorage.getItem('requests');
            if (savedRequests) requests = JSON.parse(savedRequests);

            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }

            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('adminRoleBtn')?.addEventListener('click', () => selectRole('admin'));
            document.getElementById('employeeRoleBtn')?.addEventListener('click', () => selectRole('employee'));
            document.getElementById('loginBtn')?.addEventListener('click', handleLogin);
            document.getElementById('registerLink')?.addEventListener('click', showRegister);
            document.getElementById('forgotLink')?.addEventListener('click', showForgotPassword);
            document.getElementById('registerBtn')?.addEventListener('click', handleRegister);
            document.getElementById('backFromRegister')?.addEventListener('click', hideRegister);
            document.getElementById('sendOtpBtn')?.addEventListener('click', sendOTP);
            document.getElementById('resendOtpBtn')?.addEventListener('click', sendOTP);
            document.getElementById('resetPasswordBtn')?.addEventListener('click', handleForgotPassword);
            document.getElementById('backFromForgot')?.addEventListener('click', hideForgotPassword);
            document.getElementById('returnDamageReport')?.addEventListener('change', function() {
                const damageGroup = document.getElementById('damageDetailsGroup');
                damageGroup.style.display = this.value !== 'No' ? 'block' : 'none';
            });
        }

        function selectRole(role) {
            selectedRole = role;
            const adminBtn = document.getElementById('adminRoleBtn');
            const employeeBtn = document.getElementById('employeeRoleBtn');
            const demoText = document.getElementById('demoText');
            
            if (role === 'admin') {
                adminBtn.classList.add('active');
                employeeBtn.classList.remove('active');
                demoText.textContent = 'Demo: admin/admin123';
            } else {
                employeeBtn.classList.add('active');
                adminBtn.classList.remove('active');
                demoText.textContent = 'Demo: employee/emp123';
            }
        }

        function handleLogin() {
            const username = document.getElementById('loginUser').value.trim();
            const password = document.getElementById('loginPass').value.trim();
            
            if (!username || !password) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ username ‡§î‡§∞ password ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            const user = users.find(u => u.username === username && u.password === password && u.role === selectedRole);
            
            if (user) {
                currentUser = user;
                sessionStorage.setItem('currentUser', JSON.stringify(user));
                document.getElementById('loginUser').value = '';
                document.getElementById('loginPass').value = '';
                showDashboard();
            } else {
                alert(`‡§ó‡§≤‡§§ credentials! ‡§Ø‡§æ ‡§Ü‡§™ ${selectedRole} ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§`);
            }
        }

        function showRegister() {
            document.getElementById('registerModal').classList.add('show');
        }

        function hideRegister() {
            document.getElementById('registerModal').classList.remove('show');
        }

        function handleRegister() {
            const username = document.getElementById('regUser').value.trim();
            const password = document.getElementById('regPass').value.trim();
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const dept = document.getElementById('regDept').value.trim();
            const role = document.getElementById('regRole').value;

            if (!username || !password || !name || !email) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä required fields ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            if (users.find(u => u.username === username)) {
                alert('‡§Ø‡§π username ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à!');
                return;
            }

            const newUser = {
                id: Date.now(),
                username, password, name, email, phone, dept, role
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            alert('‚úÖ Registration ‡§∏‡§´‡§≤!');
            
            document.getElementById('regUser').value = '';
            document.getElementById('regPass').value = '';
            document.getElementById('regName').value = '';
            document.getElementById('regEmail').value = '';
            document.getElementById('regPhone').value = '';
            document.getElementById('regDept').value = '';
            
            hideRegister();
        }

        function showForgotPassword() {
            document.getElementById('otpRequestSection').style.display = 'block';
            document.getElementById('otpVerifySection').style.display = 'none';
            document.getElementById('forgotUser').value = '';
            document.getElementById('otpInput').value = '';
            document.getElementById('forgotNewPass').value = '';
            document.getElementById('forgotConfirmPass').value = '';
            generatedOTP = null;
            otpUsername = null;
            document.getElementById('forgotModal').classList.add('show');
        }

        function hideForgotPassword() {
            document.getElementById('forgotModal').classList.remove('show');
        }

        function sendOTP() {
            const username = document.getElementById('forgotUser').value.trim();
            
            if (!username) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ username ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            const user = users.find(u => u.username === username);
            
            if (!user) {
                alert('‡§Ø‡§π username registered ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!');
                return;
            }

            generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
            otpUsername = username;
            
            alert(`‚úÖ OTP sent!\n\nYour OTP: ${generatedOTP}\n\n(In production, sent via email/SMS)`);
            
            document.getElementById('otpRequestSection').style.display = 'none';
            document.getElementById('otpVerifySection').style.display = 'block';
            document.getElementById('otpSentMsg').textContent = `OTP sent to ${username}'s registered contact`;
        }

        function handleForgotPassword() {
            const enteredOTP = document.getElementById('otpInput').value.trim();
            const newPass = document.getElementById('forgotNewPass').value.trim();
            const confirmPass = document.getElementById('forgotConfirmPass').value.trim();

            if (!enteredOTP || !newPass || !confirmPass) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä fields ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            if (enteredOTP !== generatedOTP) {
                alert('‚ùå ‡§ó‡§≤‡§§ OTP!');
                return;
            }

            if (newPass !== confirmPass) {
                alert('‚ùå Passwords match ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡•á!');
                return;
            }

            const userIndex = users.findIndex(u => u.username === otpUsername);
            users[userIndex].password = newPass;
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('‚úÖ Password successfully reset!');
            hideForgotPassword();
        }

        function showDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('userName').textContent = 'Welcome, ' + currentUser.name;
            document.getElementById('userBadge').textContent = currentUser.role.toUpperCase();
            document.getElementById('userBadge').className = 'badge badge-' + currentUser.role;
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminNav').style.display = 'block';
                document.getElementById('employeeNav').style.display = 'none';
                switchDashboard('overview');
            } else {
                document.getElementById('adminNav').style.display = 'none';
                document.getElementById('employeeNav').style.display = 'block';
                switchDashboard('myAssets');
            }
            
            loadAllData();
        }

        function handleLogout() {
            sessionStorage.clear();
            currentUser = null;
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('loginUser').value = '';
            document.getElementById('loginPass').value = '';
            selectRole('admin');
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
        }

        function switchDashboard(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event?.target?.classList.add('active');
            document.getElementById(tab + 'Tab')?.classList.add('active');
            
            loadAllData();
        }

        function loadAllData() {
            if (currentUser.role === 'admin') {
                loadStats();
                loadAssets();
                loadAssignments();
                loadRequests();
                loadReports();
                populateDropdowns();
            } else {
                loadEmployeeAssets();
                loadEmployeeRequests();
                populateEmployeeDropdowns();
            }
        }

        function loadStats() {
            document.getElementById('totalAssets').textContent = assets.length;
            document.getElementById('availableAssets').textContent = assets.filter(a => a.status === 'Available').length;
            document.getElementById('inUseAssets').textContent = assets.filter(a => a.status === 'In-Use').length;
            document.getElementById('pendingRequests').textContent = requests.filter(r => r.status === 'Pending').length;
            
            const activities = [
                ...assignments.slice(-5).reverse().map(a => ({
                    type: 'assignment',
                    text: `Asset ${a.assetName} assigned to ${a.employeeName}`,
                    date: a.assignDate
                })),
                ...requests.slice(-5).reverse().map(r => ({
                    type: 'request',
                    text: `${r.employeeName} requested ${r.assetType}`,
                    date: r.requestDate
                }))
            ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);

            document.getElementById('recentActivities').innerHTML = activities.length ? activities.map(a => `
                <div class="asset-item">
                    <div class="item-name">${a.text}</div>
                    <div style="color: rgba(255,255,255,0.6); font-size: 0.875rem;">${new Date(a.date).toLocaleDateString()}</div>
                </div>
            `).join('') : '<div class="empty"><p>No recent activities</p></div>';
        }

        function saveAsset() {
            const name = document.getElementById('assetName').value.trim();
            const assetId = document.getElementById('assetId').value.trim();
            const type = document.getElementById('assetType').value;
            const value = document.getElementById('assetValue').value || '0';
            const status = document.getElementById('assetStatus').value;
            const location = document.getElementById('assetLocation').value.trim();
            const description = document.getElementById('assetDesc').value.trim();

            if (!name || !assetId || !type) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä required fields ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            if (assets.find(a => a.assetId === assetId)) {
                alert('‡§Ø‡§π Asset ID ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à!');
                return;
            }

            const asset = {
                id: Date.now(),
                assetId, name, type,
                value: parseFloat(value),
                status, location, description,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };

            assets.push(asset);
            localStorage.setItem('assets', JSON.stringify(assets));
            
            document.getElementById('assetName').value = '';
            document.getElementById('assetId').value = '';
            document.getElementById('assetType').value = '';
            document.getElementById('assetValue').value = '';
            document.getElementById('assetStatus').value = 'Available';
            document.getElementById('assetLocation').value = '';
            document.getElementById('assetDesc').value = '';
            
            loadAssets();
            alert('‚úÖ Asset successfully added!');
        }

        function loadAssets() {
            const search = document.getElementById('searchAssets')?.value.toLowerCase() || '';
            const filtered = assets.filter(a => 
                a.name.toLowerCase().includes(search) ||
                a.assetId.toLowerCase().includes(search) ||
                a.type.toLowerCase().includes(search)
            );

            const list = document.getElementById('assetsList');
            if (!list) return;

            list.innerHTML = filtered.length ? filtered.map(a => `
                <div class="asset-item">
                    <div class="item-header">
                        <div>
                            <div class="item-name">${a.name} (${a.assetId})</div>
                            <span class="status status-${a.status.toLowerCase().replace('-', '')}">${a.status}</span>
                        </div>
                        <div class="item-actions">
                            <button class="btn-sm btn-warning" onclick="changeAssetStatus(${a.id})">Change Status</button>
                            <button class="btn-sm btn-danger" onclick="deleteAsset(${a.id})">Delete</button>
                        </div>
                    </div>
                    <div class="item-details">
                        <div><strong>Type:</strong> ${a.type}</div>
                        <div><strong>Value:</strong> ‚Çπ${a.value.toLocaleString()}</div>
                        <div><strong>Location:</strong> ${a.location || 'N/A'}</div>
                        <div><strong>Created:</strong> ${new Date(a.createdAt).toLocaleDateString()}</div>
                    </div>
                </div>
            `).join('') : '<div class="empty"><p>No assets found</p></div>';
        }

        function changeAssetStatus(id) {
            const asset = assets.find(a => a.id === id);
            const newStatus = prompt(`Current Status: ${asset.status}\n\nEnter new status:\n- Available\n- In-Use\n- Maintenance\n- Damaged\n- Lost`, asset.status);
            
            if (newStatus && ['Available', 'In-Use', 'Maintenance', 'Damaged', 'Lost'].includes(newStatus)) {
                asset.status = newStatus;
                localStorage.setItem('assets', JSON.stringify(assets));
                loadAssets();
                alert('‚úÖ Status updated!');
            }
        }

        function deleteAsset(id) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ asset ‡§ï‡•ã delete ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                assets = assets.filter(a => a.id !== id);
                localStorage.setItem('assets', JSON.stringify(assets));
                loadAssets();
            }
        }

        function populateDropdowns() {
            const availableAssets = assets.filter(a => a.status === 'Available');
            const employees = users.filter(u => u.role === 'employee');
            const activeAssignments = assignments.filter(a => !a.returnDate);

            document.getElementById('assignAssetId').innerHTML = '<option value="">Select Asset</option>' +
                availableAssets.map(a => `<option value="${a.id}">${a.name} (${a.assetId})</option>`).join('');

            document.getElementById('assignEmployeeId').innerHTML = '<option value="">Select Employee</option>' +
                employees.map(e => `<option value="${e.id}">${e.name} (${e.dept})</option>`).join('');

            document.getElementById('returnAssignmentId').innerHTML = '<option value="">Select Assignment</option>' +
                activeAssignments.map(a => `<option value="${a.id}">${a.assetName} ‚Üí ${a.employeeName}</option>`).join('');

            document.getElementById('historyAssetSelect').innerHTML = '<option value="">Select Asset</option>' +
                assets.map(a => `<option value="${a.id}">${a.name} (${a.assetId})</option>`).join('');
        }

        function assignAsset() {
            const assetId = parseInt(document.getElementById('assignAssetId').value);
            const employeeId = parseInt(document.getElementById('assignEmployeeId').value);
            const assignDate = document.getElementById('assignDate').value;
            const notes = document.getElementById('assignNotes').value.trim();

            if (!assetId || !employeeId) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ asset ‡§î‡§∞ employee ‡§¶‡•ã‡§®‡•ã‡§Ç select ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const asset = assets.find(a => a.id === assetId);
            const employee = users.find(u => u.id === employeeId);

            const assignment = {
                id: Date.now(),
                assetId: asset.id,
                assetName: asset.name,
                assetAssetId: asset.assetId,
                employeeId: employee.id,
                employeeName: employee.name,
                assignDate: assignDate || new Date().toISOString().split('T')[0],
                notes: notes,
                returnDate: null,
                condition: null
            };

            assignments.push(assignment);
            asset.status = 'In-Use';
            
            localStorage.setItem('assignments', JSON.stringify(assignments));
            localStorage.setItem('assets', JSON.stringify(assets));

            document.getElementById('assignAssetId').value = '';
            document.getElementById('assignEmployeeId').value = '';
            document.getElementById('assignDate').value = '';
            document.getElementById('assignNotes').value = '';

            loadAllData();
            alert('‚úÖ Asset successfully assigned!');
        }

        function returnAsset() {
            const assignmentId = parseInt(document.getElementById('returnAssignmentId').value);
            const condition = document.getElementById('returnCondition').value;
            const notes = document.getElementById('returnNotes').value.trim();

            if (!assignmentId) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ assignment select ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const assignment = assignments.find(a => a.id === assignmentId);
            const asset = assets.find(a => a.id === assignment.assetId);

            assignment.returnDate = new Date().toISOString().split('T')[0];
            assignment.condition = condition;
            assignment.returnNotes = notes;

            if (condition === 'Good') {
                asset.status = 'Available';
            } else if (condition === 'Fair') {
                asset.status = 'Maintenance';
            } else {
                asset.status = 'Damaged';
            }

            localStorage.setItem('assignments', JSON.stringify(assignments));
            localStorage.setItem('assets', JSON.stringify(assets));

            document.getElementById('returnAssignmentId').value = '';
            document.getElementById('returnCondition').value = 'Good';
            document.getElementById('returnNotes').value = '';

            loadAllData();
            alert('‚úÖ Asset successfully returned!');
        }

        function loadAssignments() {
            const activeAssignments = assignments.filter(a => !a.returnDate);
            const list = document.getElementById('assignmentsList');
            if (!list) return;

            list.innerHTML = activeAssignments.length ? activeAssignments.map(a => `
                <div class="request-item">
                    <div class="item-header">
                        <div>
                            <div class="item-name">${a.assetName} (${a.assetAssetId})</div>
                            <span class="status status-in-use">In-Use</span>
                        </div>
                    </div>
                    <div class="item-details">
                        <div><strong>Employee:</strong> ${a.employeeName}</div>
                        <div><strong>Assigned:</strong> ${new Date(a.assignDate).toLocaleDateString()}</div>
                        ${a.notes ? `<div style="grid-column: 1 / -1;"><strong>Notes:</strong> ${a.notes}</div>` : ''}
                    </div>
                </div>
            `).join('') : '<div class="empty"><p>No active assignments</p></div>';
        }

        function loadRequests() {
            const pending = requests.filter(r => r.status === 'Pending');
            const all = requests;

            const pendingList = document.getElementById('pendingRequestsList');
            if (pendingList) {
                pendingList.innerHTML = pending.length ? pending.map(r => `
                    <div class="request-item">
                        <div class="item-header">
                            <div>
                                <div class="item-name">${r.type === 'new' ? 'New Asset Request' : 'Return Request'}</div>
                                <span class="status status-pending">Pending</span>
                            </div>
                            <div class="item-actions">
                                <button class="btn-sm btn-success" onclick="approveRequest(${r.id})">‚úì Approve</button>
                                <button class="btn-sm btn-danger" onclick="rejectRequest(${r.id})">‚úó Reject</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <div><strong>Employee:</strong> ${r.employeeName}</div>
                            <div><strong>Date:</strong> ${new Date(r.requestDate).toLocaleDateString()}</div>
                            ${r.type === 'new' ? `
                                <div><strong>Asset Type:</strong> ${r.assetType}</div>
                                <div><strong>Priority:</strong> ${r.priority}</div>
                                <div style="grid-column: 1 / -1;"><strong>Reason:</strong> ${r.reason}</div>
                            ` : `
                                <div><strong>Asset:</strong> ${r.assetName}</div>
                                <div><strong>Damage:</strong> ${r.damageReport}</div>
                                ${r.damageDetails ? `<div style="grid-column: 1 / -1;"><strong>Details:</strong> ${r.damageDetails}</div>` : ''}
                            `}
                        </div>
                    </div>
                `).join('') : '<div class="empty"><p>No pending requests</p></div>';
            }

            const allList = document.getElementById('allRequestsList');
            if (allList) {
                allList.innerHTML = all.length ? all.map(r => `
                    <div class="request-item">
                        <div class="item-header">
                            <div>
                                <div class="item-name">${r.type === 'new' ? 'New Asset Request' : 'Return Request'}</div>
                                <span class="status status-${r.status.toLowerCase()}">${r.status}</span>
                            </div>
                        </div>
                        <div class="item-details">
                            <div><strong>Employee:</strong> ${r.employeeName}</div>
                            <div><strong>Date:</strong> ${new Date(r.requestDate).toLocaleDateString()}</div>
                            ${r.type === 'new' ? `<div><strong>Asset Type:</strong> ${r.assetType}</div>` : `<div><strong>Asset:</strong> ${r.assetName}</div>`}
                            ${r.approvedBy ? `<div><strong>Processed By:</strong> ${r.approvedBy}</div>` : ''}
                        </div>
                    </div>
                `).join('') : '<div class="empty"><p>No requests yet</p></div>';
            }
        }

        function approveRequest(id) {
            const request = requests.find(r => r.id === id);
            request.status = 'Approved';
            request.approvedBy = currentUser.name;
            request.approvedDate = new Date().toISOString();

            localStorage.setItem('requests', JSON.stringify(requests));
            loadRequests();
            alert('‚úÖ Request approved!');
        }

        function rejectRequest(id) {
            const reason = prompt('Rejection reason (optional):');
            const request = requests.find(r => r.id === id);
            request.status = 'Rejected';
            request.approvedBy = currentUser.name;
            request.approvedDate = new Date().toISOString();
            request.rejectionReason = reason;

            localStorage.setItem('requests', JSON.stringify(requests));
            loadRequests();
            alert('‚ùå Request rejected!');
        }

        function loadReports() {
            const allocationList = document.getElementById('allocationReport');
            if (allocationList) {
                const employeeAssets = {};
                assignments.filter(a => !a.returnDate).forEach(a => {
                    if (!employeeAssets[a.employeeName]) {
                        employeeAssets[a.employeeName] = [];
                    }
                    employeeAssets[a.employeeName].push(a.assetName);
                });

                const report = Object.keys(employeeAssets).map(emp => `
                    <div class="asset-item">
                        <div class="item-name">${emp}</div>
                        <div class="item-details">
                            <div style="grid-column: 1 / -1;"><strong>Assets:</strong> ${employeeAssets[emp].join(', ')}</div>
                        </div>
                    </div>
                `).join('');

                allocationList.innerHTML = report || '<div class="empty"><p>No assets currently assigned</p></div>';
            }
        }

        function loadAssetHistory() {
            const assetId = parseInt(document.getElementById('historyAssetSelect').value);
            const list = document.getElementById('assetHistoryLog');
            if (!list) return;

            if (!assetId) {
                list.innerHTML = '<div class="empty"><p>Select an asset to view history</p></div>';
                return;
            }

            const history = assignments.filter(a => a.assetId === assetId);
            list.innerHTML = history.length ? history.map(h => `
                <div class="asset-item">
                    <div class="item-header">
                        <div>
                            <div class="item-name">Assignment to ${h.employeeName}</div>
                            <span class="status ${h.returnDate ? 'status-approved' : 'status-in-use'}">
                                ${h.returnDate ? 'Returned' : 'In-Use'}
                            </span>
                        </div>
                    </div>
                    <div class="item-details">
                        <div><strong>Assigned:</strong> ${new Date(h.assignDate).toLocaleDateString()}</div>
                        ${h.returnDate ? `<div><strong>Returned:</strong> ${new Date(h.returnDate).toLocaleDateString()}</div>` : ''}
                        ${h.condition ? `<div><strong>Condition:</strong> ${h.condition}</div>` : ''}
                        ${h.notes ? `<div style="grid-column: 1 / -1;"><strong>Notes:</strong> ${h.notes}</div>` : ''}
                    </div>
                </div>
            `).join('') : '<div class="empty"><p>No history for this asset</p></div>';
        }

        function loadEmployeeAssets() {
            const myAssets = assignments.filter(a => 
                a.employeeId === currentUser.id && !a.returnDate
            );

            const list = document.getElementById('employeeAssetsList');
            if (!list) return;

            list.innerHTML = myAssets.length ? myAssets.map(a => `
                <div class="asset-item">
                    <div class="item-header">
                        <div>
                            <div class="item-name">${a.assetName} (${a.assetAssetId})</div>
                            <span class="status status-in-use">In-Use</span>
                        </div>
                    </div>
                    <div class="item-details">
                        <div><strong>Assigned Date:</strong> ${new Date(a.assignDate).toLocaleDateString()}</div>
                        ${a.notes ? `<div style="grid-column: 1 / -1;"><strong>Notes:</strong> ${a.notes}</div>` : ''}
                    </div>
                </div>
            `).join('') : '<div class="empty"><p>You have no assigned assets</p></div>';
        }

        function populateEmployeeDropdowns() {
            const myAssets = assignments.filter(a => 
                a.employeeId === currentUser.id && !a.returnDate
            );

            document.getElementById('returnRequestAsset').innerHTML = '<option value="">Select Asset</option>' +
                myAssets.map(a => `<option value="${a.id}">${a.assetName} (${a.assetAssetId})</option>`).join('');
        }

        function submitRequest() {
            const assetType = document.getElementById('requestAssetType').value;
            const reason = document.getElementById('requestReason').value.trim();
            const priority = document.getElementById('requestPriority').value;

            if (!assetType || !reason) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ asset type ‡§î‡§∞ reason ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            const request = {
                id: Date.now(),
                type: 'new',
                employeeId: currentUser.id,
                employeeName: currentUser.name,
                assetType: assetType,
                reason: reason,
                priority: priority,
                status: 'Pending',
                requestDate: new Date().toISOString()
            };

            requests.push(request);
            localStorage.setItem('requests', JSON.stringify(requests));

            document.getElementById('requestAssetType').value = '';
            document.getElementById('requestReason').value = '';
            document.getElementById('requestPriority').value = 'Low';

            alert('‚úÖ Request submitted successfully!');
            loadEmployeeRequests();
        }

        function submitReturnRequest() {
            const assignmentId = parseInt(document.getElementById('returnRequestAsset').value);
            const returnReason = document.getElementById('returnRequestReason').value.trim();
            const damageReport = document.getElementById('returnDamageReport').value;
            const damageDetails = document.getElementById('damageDetails').value.trim();

            if (!assignmentId) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ asset select ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const assignment = assignments.find(a => a.id === assignmentId);

            const request = {
                id: Date.now(),
                type: 'return',
                employeeId: currentUser.id,
                employeeName: currentUser.name,
                assetId: assignment.assetId,
                assetName: assignment.assetName,
                assignmentId: assignmentId,
                returnReason: returnReason,
                damageReport: damageReport,
                damageDetails: damageDetails,
                status: 'Pending',
                requestDate: new Date().toISOString()
            };

            requests.push(request);
            localStorage.setItem('requests', JSON.stringify(requests));

            document.getElementById('returnRequestAsset').value = '';
            document.getElementById('returnRequestReason').value = '';
            document.getElementById('returnDamageReport').value = 'No';
            document.getElementById('damageDetails').value = '';
            document.getElementById('damageDetailsGroup').style.display = 'none';

            alert('‚úÖ Return request submitted!');
            loadEmployeeRequests();
        }

        function loadEmployeeRequests() {
            const myRequests = requests.filter(r => r.employeeId === currentUser.id);
            const list = document.getElementById('employeeRequestsList');
            if (!list) return;

            list.innerHTML = myRequests.length ? myRequests.map(r => `
                <div class="request-item">
                    <div class="item-header">
                        <div>
                            <div class="item-name">${r.type === 'new' ? 'New Asset Request' : 'Return Request'}</div>
                            <span class="status status-${r.status.toLowerCase()}">${r.status}</span>
                        </div>
                    </div>
                    <div class="item-details">
                        <div><strong>Date:</strong> ${new Date(r.requestDate).toLocaleDateString()}</div>
                        ${r.type === 'new' ? `
                            <div><strong>Asset Type:</strong> ${r.assetType}</div>
                            <div><strong>Priority:</strong> ${r.priority}</div>
                            <div style="grid-column: 1 / -1;"><strong>Reason:</strong> ${r.reason}</div>
                        ` : `
                            <div><strong>Asset:</strong> ${r.assetName}</div>
                            <div><strong>Damage:</strong> ${r.damageReport}</div>
                        `}
                        ${r.approvedBy ? `<div><strong>Processed By:</strong> ${r.approvedBy}</div>` : ''}
                        ${r.rejectionReason ? `<div style="grid-column: 1 / -1; color: #fca5a5;"><strong>Rejection Reason:</strong> ${r.rejectionReason}</div>` : ''}
                    </div>
                </div>
            `).join('') : '<div class="empty"><p>No requests yet</p></div>';
        }

        function showProfile() {
            document.getElementById('profileModal').classList.add('show');
            document.getElementById('profilePhoto').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileDept').value = currentUser.dept || '';
            document.getElementById('profileRole').value = currentUser.role || '';
        }

        function closeProfile() {
            document.getElementById('profileModal').classList.remove('show');
        }

        function updateProfile() {
            const name = document.getElementById('profileName').value.trim();
            const email = document.getElementById('profileEmail').value.trim();
            const phone = document.getElementById('profilePhone').value.trim();
            const dept = document.getElementById('profileDept').value.trim();

            if (!name || !email) {
                alert('Name ‡§î‡§∞ Email required ‡§π‡•à‡§Ç!');
                return;
            }

            currentUser.name = name;
            currentUser.email = email;
            currentUser.phone = phone;
            currentUser.dept = dept;

            const userIndex = users.findIndex(u => u.id === currentUser.id);
            users[userIndex] = currentUser;

            localStorage.setItem('users', JSON.stringify(users));
            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));

            document.getElementById('userName').textContent = 'Welcome, ' + currentUser.name;
            
            alert('‚úÖ Profile updated successfully!');
            closeProfile();
        }

        window.onload = init;
    </script>
</body>
</html>
